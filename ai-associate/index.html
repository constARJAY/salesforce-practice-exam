<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce AI Associate Certification - Practice Exam</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <style>
        :root {
            --number-todo: whitesmoke;
            --number-active: rgb(94, 146, 205);
            --number-correct: rgb(102, 197, 122);
            --number-wrong: rgb(228, 122, 122);
            --number-for-review: rgb(224, 228, 122);
            --number-current: rgb(167, 176, 187);
        }
        html, * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        .question-content {
            background-color: #e9ecef;
            padding: 10px 15px;
            margin-top: 10px;
            border-radius: 10px;
            min-height: 200px;
            height: auto;
            max-height: 500px;
            overflow-y: auto;
        }
        .question-numbers {
            flex-wrap: wrap;
            /* padding-bottom: 10px; */
        }
        .question-number {
            border: 1px solid black;
            background-color: var(--number-todo);
            /* min-width: 30px; */
            width: 35px;
            text-align: center;
            cursor: pointer;
            /* padding: 2px 5px; */
            height: 100%;
        }
        .question-number.active, .box.active {
            background-color: var(--number-active);
        }
        .question-number.correct, .box.correct {
            background-color: var(--number-correct);
        }
        .question-number.wrong, .box.wrong {
            background-color: var(--number-wrong);
        }
        .question-number.for-review, .box.for-review {
            background-color: var(--number-for-review);
        }
        .question-number.current, .box.current {
            background-color: var(--number-current);
        }
        .current.active {
            background-color: #2570c6 !important;
        }
        .current.correct {
            background-color: #20c643 !important;
        }
        .current.wrong {
            background-color: #de2323 !important;
        }
        .current.for-review {
            background-color: #d1d81f !important;
        }
        .box {
            border: 1px solid gray;
            width: 20px;
            height: 20px;
        }
        .questions {
            font-size: 1.1rem;
        }
        .answer {
            font-weight: bold;
        }
        input.choice {
            /* 
            height: 15px;
            width: 20px;
            */
        }
        .bg-wrong {
            background-color: var(--number-wrong);
            /* padding: 2px; */
        }
        .bg-correct {
            background-color: var(--number-correct);
            /* padding: 2px; */
        }
        .bg-for-review {
            background-color: var(--number-for-review);
            /* padding: 2px; */
        }
        .explanation {
            font-style: italic;
        }
        .font-weight-bold {
            font-weight: bold !important;
        }
        .result {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .form-check-input:disabled~.form-check-label, .form-check-input[disabled]~.form-check-label {
            opacity: .8 !important;
        }
    </style>
</head>
<body>
    <main class="container mt-4 px-5">
        <section class="title-timer">
            <div class="d-flex justify-content-between align-items-center" style="font-weight: bold;">
                <div class="title text-uppercase">
                    <h2 class="mb-0">Salesforce AI Associate</h2>
                    <small class="text-muted">Practice Exam</small>
                </div>
            </div>
        </section>
        <hr>
        <section class="instructions" id="section-instructions">
            <div class="mb-3">
                <h5 class="font-weight-bold mb-0">Instructions:</h5>
                <span>Please answer the following questions to the best of your ability.</span>
            </div>
            <div class="mb-3">
                <h5 class="font-weight-bold mb-0">Number of Questions:</h5>
                <div class="btn-group mt-2">
                    <input type="radio" class="btn-check" name="number-of-question" id="question-number-30" value="30" autocomplete="off" checked>
                    <label class="btn btn-outline-secondary" for="question-number-30">30</label>

                    <input type="radio" class="btn-check" name="number-of-question" id="question-number-60" value="60" autocomplete="off">
                    <label class="btn btn-outline-secondary" for="question-number-60">60</label>

                    <input type="radio" class="btn-check" name="number-of-question" id="question-number-90" value="90" autocomplete="off">
                    <label class="btn btn-outline-secondary" for="question-number-90">90</label>

                    <input type="radio" class="btn-check" name="number-of-question" id="question-number-all" value="ALL" autocomplete="off">
                    <label class="btn btn-outline-secondary" for="question-number-all">ALL</label>
                </div>
            </div>
            <div class="mb-3">
                <h5 class="font-weight-bold mb-0">Time Limit:</h5>
                <div class="btn-group mt-2">
                    <input type="radio" class="btn-check" name="time-limit" id="time-limit-20" value="20" autocomplete="off">
                    <label class="btn btn-outline-secondary" for="time-limit-20">20</label>

                    <input type="radio" class="btn-check" name="time-limit" id="time-limit-30" value="30" autocomplete="off" checked>
                    <label class="btn btn-outline-secondary" for="time-limit-30">30</label>

                    <input type="radio" class="btn-check" name="time-limit" id="time-limit-60" value="60" autocomplete="off">
                    <label class="btn btn-outline-secondary" for="time-limit-60">60</label>

                    <input type="radio" class="btn-check" name="time-limit" id="time-limit-90" value="90" autocomplete="off">
                    <label class="btn btn-outline-secondary" for="time-limit-90">90</label>
                </div>
            </div>
            <div class="mb-3">
                <h5 class="font-weight-bold mb-0">Passing Score:</h5>
                <span>70%</span>
            </div>
            <div class="mt-3">
                <button class="btn btn-primary py-2 px-3 w-100" id="btn-start">START</button>
            </div>
        </section>
        <section class="section-numbers d-none" id="section-numbers">
            <div class="row">
                <div class="col-12 px-3 pt-2">
                    <div class="content numbers row h-100">
                        <div class="col-12 pt-2">
                            <div class="question-numbers d-flex justify-content-start align-items-center gap-1" id="question-numbers"></div>
                        </div>
                    </div>
                </div>
                <div class="col-12 pt-3">
                    <div class="d-flex justify-content-start align-items-center gap-2 flex-wrap">
                        <div class="d-flex justify-content-start gap-2 align-items-center">
                            <div class="box todo">&nbsp;</div>
                            <label for="">UNANSWERED</label>
                        </div>
                        <div class="d-flex justify-content-start gap-2 align-items-center">
                            <div class="box active">&nbsp;</div>
                            <label for="">ANSWERED</label>
                        </div>
                        <div class="d-flex justify-content-start gap-2 align-items-center">
                            <div class="box correct">&nbsp;</div>
                            <label for="">CORRECT</label>
                        </div>
                        <div class="d-flex justify-content-start gap-2 align-items-center">
                            <div class="box wrong">&nbsp;</div>
                            <label for="">INCORRECT</label>
                        </div>
                        <div class="d-flex justify-content-start gap-2 align-items-center">
                            <div class="box for-review">&nbsp;</div>
                            <label for="">FOR REVIEW</label>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="section-questions mt-3 d-none" id="section-questions">
            <div class="result" id="exam-result-header"></div>
            <div class="questions row" id="questions">
                <div class="review-timer col-12" id="review-timer">
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-secondary" id="btn-review">MARK AS FOR REVIEW</button>
                        <div id="time">00:00:00</div>
                    </div>
                </div>
                <div class="content col-12">
                    <p class="question">1. Lorem ipsum dolor, sit amet consectetur adipisicing elit. Harum ex enim, delectus sunt ipsam sint deleniti! Amet non repellat, necessitatibus, facilis iusto deleniti sed rerum, odio quae officiis ad vero? <b>Choose 2 anwers.</b></p>
                    <hr>
                    <div class="choices">
                        <div class="choice d-flex align-items-center justify-content-start">
                            <label for=""><input type="checkbox" class="choice" name="choice" id="choice1" checked><span class="px-2 answer">A. Option 1</span></label>
                        </div>
                        <div class="choice d-flex align-items-center justify-content-start">
                            <label for=""><input type="checkbox" class="choice" name="choice" id="choice2"><span class="px-2">B. Option 2</span></label>
                        </div>
                        <div class="choice d-flex align-items-center justify-content-start">
                            <label for=""><input type="checkbox" class="choice" name="choice" id="choice3"><span class="px-2">C. Option 3</span></label>
                        </div>
                        <div class="choice d-flex align-items-center justify-content-start">
                            <label for=""><input type="checkbox" class="choice" name="choice" id="choice4"><span class="px-2">D. Option 4</span></label>
                        </div>
                    </div>
                    <div class="remarks">
                        <hr><p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Sed a quis provident asperiores voluptas hic quisquam fugit modi nesciunt tempora aliquid voluptate nulla voluptatum pariatur unde, animi impedit atque natus.</p>
                    </div>
                </div>
                <div class="content col-12">
                    <p class="question">1. Lorem ipsum dolor, sit amet consectetur adipisicing elit. Harum ex enim, delectus sunt ipsam sint deleniti! Amet non repellat, necessitatibus, facilis iusto deleniti sed rerum, odio quae officiis ad vero? <b>Choose 2 anwers.</b></p>
                    <hr>
                    <div class="choices">
                        <div class="choice d-flex align-items-center justify-content-start">
                            <label for=""><input type="radio" class="choice" name="choice" id="choice1"><span class="px-2">A. Option 1</span></label>
                        </div>
                        <div class="choice d-flex align-items-center justify-content-start">
                            <label for=""><input type="radio" class="choice" name="choice" id="choice2"><span class="px-2">B. Option 2</span></label>
                        </div>
                        <div class="choice d-flex align-items-center justify-content-start">
                            <label for=""><input type="radio" class="choice" name="choice" id="choice3"><span class="px-2">C. Option 3</span></label>
                        </div>
                        <div class="choice d-flex align-items-center justify-content-start">
                            <label for=""><input type="radio" class="choice" name="choice" id="choice4"><span class="px-2">D. Option 4</span></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="progress my-2">
                <div class="progress-bar" role="progressbar" style="width: 25%; background-color: #198754;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" id="progress-bar"></div>
            </div>
            <div class="result" id="exam-result-footer"></div>
        </section>
        <section class="section-buttons d-none" id="section-buttons"></section>
    </main>


    <script>
        const PASSING_SCORE_PERCENTAGE = 70;
        let QUESTION_LIMIT = 70;
        let MAX_QUESTION = 119;
        let TIME_LIMIT = 90; // in minutes
        let TIME_USED_DISPLAY = '00:00:00';
        let QUESTION_LIST = [];
        let ANSWER_LIST = [];
        let STARTED_EXAM = false;
        let FINISHED_EXAM = false;
        
        function getQuestionAnswers() {
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: "ai-associate.json",
                    dataType: "json",
                    success: function(response) {
                        resolve(response);
                        QUESTION_LIST = response.questions || [];
                        ANSWER_LIST = response.answers || [];
                    },
                    error: function(error) {
                        reject(error);
                    }
                });
            });
        }
        getQuestionAnswers();

        function displayQuestionNumbers() {
            let html = '';
            for (let i = 1; i <= QUESTION_LIMIT; i++) {
                let current = i == 1 ? 'current' : '';
                html += `<div class="question-number ${current}" id="question-number${i}" number="${i}">${i}</div>`;
            }
            $("#question-numbers").html(html);
        }

        function displayButtons(isRetake = false) {
            let html = `
            <div class="row my-3">
                <div class="col-md-6 col-sm-12 py-2 d-flex justify-content-start align-items-center">
                    <div class="d-flex justify-content-end align-items-center gap-1">
                        <button class="btn btn-outline-primary" id="btn-previous" disabled>PREVIOUS</button>
                        <button class="btn btn-primary" id="btn-next">NEXT</button>
                    </div>
                </div>
                <div class="col-md-6 col-sm-12 py-2 d-flex justify-content-end align-items-center">
                    <div class="d-flex justify-content-end align-items-center gap-1">
                        <button class="btn btn-warning" id="btn-check">CHECK</button>
                        <button class="btn btn-success" id="btn-submit">SUBMIT</button>
                    </div>
                </div>
            </div>`;

            if (isRetake) {
                html = `
                <div class="row my-3 pt-5">
                    <div class="col-12 d-flex justify-content-center align-items-center">
                        <button class="btn btn-primary w-100" id="btn-retake">RETAKE EXAM</button>
                    </div>
                </div>`;
            }

            $("#section-buttons").html(html);
        }

        function displayExamQuestions() {
            displayQuestionNumbers();
            displayButtons();

            let questions = QUESTION_LIST || [];

            let randomQuestions = questions.sort(() => Math.random() - 0.5).slice(0, QUESTION_LIMIT);
            let html = `
            <div class="review-timer col-12" id="review-timer">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-secondary" id="btn-review">MARK AS FOR REVIEW</button>
                    <div id="time" class="font-weight-bold">00:00:00</div>
                </div>
            </div>`;

            for (let i = 0; i < randomQuestions.length; i++) {
                let { id, question, choices } = randomQuestions[i];
                let questionNumber = i + 1;

                choices = choices.sort(() => Math.random() - 0.5);
                let choicesHTML = '';
                choices.forEach((choice, index) => {
                    let { id: choiceId, value: choiceValue } = choice;
                    choicesHTML += `
                    <div class="parent-choice form-check" id="parent-choice${id + choiceId}" question-id="${id}">
                        <input type="radio" class="choice form-check-input" question-id="${id}" name="choice${id}" id="choice${id + choiceId}" value="${choiceId}" question-number="${questionNumber}">
                        <label class="form-check-label" for="choice${id + choiceId}">
                            <span class="px-2">${choiceValue}</span>
                        </label>
                    </div>`;
                })

                let display = i === 0 ? 'd-block' : 'd-none';
                html += `
                <div class="question-content col-12 ${display}" id="question-content${questionNumber}" question-id="${id}">
                    <p class="question"><span class="font-weight-bold">${questionNumber}.</span> ${question}</p>
                    <hr>
                    <div class="choices">
                        ${choicesHTML}
                    </div>
                    <div class="remarks"></div>
                </div>`;
            }

            $("#questions").html(html);
        }

        function getUserAnswers() {
            let answers = [];
            $(".choice:checked").each(function() {
                let questionId = $(this).attr("question-id");
                let choiceId = $(this).val();
                answers.push({ questionId, choiceId });
            });
            return answers;
        }

        function checkExamAnswers(data) {
            let answers = data.answers || [];
            let userAnswers = getUserAnswers();

            // Reset all classes
            $('.parent-choice').removeClass("bg-correct").removeClass("bg-wrong").removeClass('bg-for-review');

            let score = 0;
            for (let i = 0; i < answers.length; i++) {
                let { id, value, explanation } = answers[i];
                let userAnswer = userAnswers?.find(answer => answer?.questionId == id);
                let isCorrect = false;

                let correctChoiceId = `#parent-choice${id}${value}`;
                let userChoiceId = `#parent-choice${id}${userAnswer?.choiceId}`;

                if (userAnswer && userAnswer.choiceId == value) {
                    score++;
                    isCorrect = true;
                }

                if (!userAnswer) {
                    $(correctChoiceId).addClass("bg-for-review");
                }
                else if (isCorrect) {
                    $(correctChoiceId).addClass("bg-correct");
                } 
                else {
                    $(userChoiceId).addClass("bg-wrong");
                    $(correctChoiceId).addClass("bg-correct");
                }

                let status = isCorrect ? "<span class='text-success'>Correct!</span>" : "<span class='text-danger'>Wrong!</span>";
                let remarks = `<hr><p class="explanation"> <b>${status}</b> ${explanation}</p>`;
                $(`#question-content${id} .remarks`).html(remarks);
            }

            let percentage = (score / QUESTION_LIMIT) * 100;
                percentage = percentage.toFixed(2);
            let passingPercentage = 70;
            let status = percentage >= passingPercentage ? "Passed" : "Failed";
            let statusClass = status == "Passed" ? "alert-success" : "alert-danger";

            let resultHTML = `
            <div class="alert ${statusClass} mt-3">
                <h5 class="card-title">${status} ${percentage}%</h5>
                <p class="card-text">
                    <b>Result: </b>
                    <span>${score} / ${QUESTION_LIMIT}</span>
                </p>
            </div>`;
            $("#exam-result-header, #exam-result-footer").html(resultHTML);
        }

        $(document).ready(function() {
            /*let qna = getQuestionAnswers();
            qna.then((data) => {
                displayExamQuestions(data);
            }).catch((error) => {
                alert("Error: " + error);
                console.log(error);
            });*/

            function checkSpecificQuestion(questionNumber) {
                let questionId = $('#question-content' + questionNumber).attr("question-id");
                let choiceId = $('[name="choice' + questionId + '"]:checked').val();

                let questionAnswer = ANSWER_LIST.find(answer => answer.id == questionId);
                let isCorrect = questionAnswer && questionAnswer.value == choiceId;

                // Reset all classes
                $(`.parent-choice[question-id=${questionId}]`).removeClass("bg-correct").removeClass("bg-wrong").removeClass('bg-for-review');

                if (!choiceId) {
                    $(`#parent-choice${questionId}${questionAnswer.value}`).removeClass("bg-correct").removeClass("bg-wrong").addClass("bg-for-review");
                }
                else if (isCorrect) {
                    $(`#parent-choice${questionId}${choiceId}`).removeClass("bg-wrong").removeClass("bg-for-review").addClass("bg-correct");
                } 
                else {
                    $(`#parent-choice${questionId}${choiceId}`).removeClass("bg-correct").removeClass("bg-for-review").addClass("bg-wrong");
                    $(`#parent-choice${questionId}${questionAnswer.value}`).removeClass("bg-for-review").removeClass("bg-wrong").addClass("bg-correct");
                }

                let numberBackground = isCorrect ? "correct" : "wrong";
                $(`.question-number[number=${questionNumber}]`).removeClass("active").removeClass('correct').removeClass('wrong').removeClass('for-review').addClass(numberBackground);

                let { explanation } = questionAnswer;
                let status = choiceId ? (isCorrect ? "<span class='text-success'>Correct!</span>" : "<span class='text-danger'>Wrong!</span>") : "";
                let remarks = `<hr><p class="explanation"> <b>${status}</b> ${explanation}</p>`;
                $(`#question-content${questionNumber} .remarks`).html(remarks);

                // disable all choices
                $(`[name="choice${questionId}"]`).attr("disabled", true);

                updateProgressBar();
                return isCorrect;
            }

            function updatePrevNextButton() {
                let currentQuestionNumber = $('.question-number.current').attr("number") || 1;
                    currentQuestionNumber = Number(currentQuestionNumber);
                if (currentQuestionNumber == 1) {
                    $('#btn-previous').attr("disabled", true);
                } else {
                    $('#btn-previous').attr("disabled", false);
                }

                if (currentQuestionNumber == QUESTION_LIMIT) {
                    $('#btn-next').attr("disabled", true);
                } else {
                    $('#btn-next').attr("disabled", false);
                }

                let isCurrentForReview = $(`.question-number[number=${currentQuestionNumber}]`).attr('for-review');
                if (isCurrentForReview == 'true') {
                    $('#btn-review').text('UNMARK AS FOR REVIEW');
                } else {
                    $('#btn-review').text('MARK AS FOR REVIEW');
                }
            }
            updatePrevNextButton();

            function updateProgressBar() {
                let answeredQuestions = $('.question-number.correct, .question-number.wrong, .question-number.active').length;
                let progress = (answeredQuestions / QUESTION_LIMIT) * 100;
                $('#progress-bar').css({
                    "width": progress + "%"
                });
            }
            updateProgressBar();

            function timer() {
                if (STARTED_EXAM) {
                    let timeLimit = TIME_LIMIT * 60; // in seconds
                    let timeUsed = 0;
                    let interval = setInterval(() => {
                        if (FINISHED_EXAM) return clearInterval(interval);

                        let hours = Math.floor(timeLimit / 3600);
                        let minutes = Math.floor(timeLimit / 60);
                        let seconds = timeLimit % 60;

                        hours = hours < 10 ? "0" + hours : hours;
                        minutes = minutes < 10 ? "0" + minutes : minutes;
                        seconds = seconds < 10 ? "0" + seconds : seconds;

                        let lastMinute = timeLimit <= 60;
                        let timeDisplay = `${hours}:${minutes}:${seconds}`;
                            timeDisplay = lastMinute ? `<span class="text-danger" style="font-size: 1.5rem;">${timeDisplay}</span>` : timeDisplay;

                        let usedHours = Math.floor(timeUsed / 3600);
                        let usedMinutes = Math.floor(timeUsed / 60);
                        let usedSeconds = timeUsed % 60;
                        usedHours = usedHours < 10 ? "0" + usedHours : usedHours;
                        usedMinutes = usedMinutes < 10 ? "0" + usedMinutes : usedMinutes;
                        usedSeconds = usedSeconds < 10 ? "0" + usedSeconds : usedSeconds;
                        TIME_USED_DISPLAY = `${usedHours}:${usedMinutes}:${usedSeconds}`;

                        $('#time').html(timeDisplay);

                        if (timeLimit < 1) {
                            $('#time').text("00:00:00");

                            Swal.fire({
                                icon: 'info',
                                title: 'Time\'s up!',
                                text: 'You have reached the time limit.',
                                showConfirmButton: false,
                                timer: 3000,
                            }).then(() => {
                                clearInterval(interval);
                                finishExam();
                            })
                        }

                        timeLimit -= 1;
                        timeUsed += 1;
                    }, 1000);
                }
                else {
                    $('#time').text("00:00:00");
                }
            }

            function startExam() {
                STARTED_EXAM = true;
                $('#btn-start, #btn-retake').text('PLEASE WAIT...').attr("disabled", true);

                let questionNumber = $(`[name="number-of-question"]:checked`).val();
                    questionNumber = questionNumber == "ALL" ? MAX_QUESTION : questionNumber;
                    questionNumber = Number(questionNumber);
                let timeLimit = $(`[name="time-limit"]:checked`).val();
                    timeLimit = Number(timeLimit);
                // alert(`You have ${timeLimit} minutes to complete ${questionNumber} questions.`);

                QUESTION_LIMIT = questionNumber;
                TIME_LIMIT = timeLimit;

                setTimeout(() => {
                    $('#section-instructions').addClass("d-none");
                    $('#section-questions, #section-numbers, #section-buttons').removeClass("d-none");
                    $('#exam-result-header, #exam-result-footer').removeClass("d-block").addClass("d-none");
                    $('#progress-bar').css('width', '0%');

                    getQuestionAnswers(); // Load data
                    displayExamQuestions(); // Display questions
                    timer();
                }, 3000)
            }

            function finishExam() {
                let score = 0;
                for (let i = 1; i <= QUESTION_LIMIT; i++) {
                    let isCorrect = checkSpecificQuestion(i);
                    
                    if (isCorrect) score++;
                }

                let percentage = (score / QUESTION_LIMIT) * 100;
                    percentage = percentage.toFixed(2);
                let status = percentage >= PASSING_SCORE_PERCENTAGE ? "Passed" : "Failed";
                let statusClass = status == "Passed" ? "alert-success" : "alert-danger";

                let resultHTML = `
                <div class="alert ${statusClass} mt-3">
                    <h5 class="card-title">${status} ${percentage}%</h5>
                    <h5 class="card-text">
                        <div>
                            Result: <span>${score} / ${QUESTION_LIMIT}</span>
                        </div>
                        <div>
                            Time: <span>${TIME_USED_DISPLAY}</span>
                        </div>
                    </h5>
                </div>`;
                $("#exam-result-header, #exam-result-footer").html(resultHTML);

                Swal.fire({
                    title: status.toUpperCase(),
                    html: resultHTML,
                    showCancelButton: false,
                    confirmButtonText: "REVIEW ANSWERS",
                    confirmButtonColor: "#3085d6",
                    showClass: {
                        popup: 'animate__animated animate__fadeInDown'
                    },
                    hideClass: {
                        popup: 'animate__animated animate__fadeOutUp'
                    }
                })

                $('.question-number').removeClass("active").removeClass('for-review');
                $('.question-content').removeClass("d-none").addClass("d-block");
                $('#review-timer').removeClass("d-block").addClass("d-none");
                updateProgressBar();
                displayButtons(true);

                FINISHED_EXAM = true;
                STARTED_EXAM = false;
            }

            // Start exam
            $(document).on("click", "#btn-start", function() {
                startExam();
            });

            // Click on question number
            $(document).on("click", ".question-number", function() {
                let questionNumber = $(this).attr("number");
                $(".question-number").removeClass("current");
                $(this).addClass("current");

                if (FINISHED_EXAM) {
                    window.location.href = "#question-content" + questionNumber;
                }
                else {
                    $('#questions .question-content').removeClass("d-block").addClass("d-none");
                    let content = `#question-content${questionNumber}`;
                    $(content).removeClass("d-none").addClass("d-block");
                    updatePrevNextButton();
                }
            });

            // Check current question
            $(document).on("click", "#btn-check", function() {
                let questionNumber = $('.question-number.current').attr("number");
                checkSpecificQuestion(questionNumber);
            });

            // Select answer
            $(document).on("click", ".choice", function() {
                let questionId = $(this).attr("question-id");
                let questionNumber = $(this).attr("question-number");
                let choice = $(`.choice[question-id=${questionId}]`).val();
                if (choice) {
                    $('.question-number[number=' + questionNumber + ']').addClass("active");
                }
                updateProgressBar();
            });

            // Mark for review
            $(document).on("click", "#btn-review", function() {
                let currentQuestionNumber = $('.question-number.current').attr("number");
                let reviewed = $(`.question-number[number=${currentQuestionNumber}]`).attr('for-review');
                if (reviewed == 'true') {
                    $(`.question-number[number=${currentQuestionNumber}]`).removeClass("for-review").attr('for-review', 'false');
                }
                else {
                    $(`.question-number[number=${currentQuestionNumber}]`).addClass("for-review").attr('for-review', 'true');
                }
                updatePrevNextButton();
            })

            // Next question
            $(document).on("click", "#btn-next", function() {
                let currentQuestionNumber = $('.question-number.current').attr("number");
                let nextQuestionNumber = Number(currentQuestionNumber) + 1;
                if (nextQuestionNumber <= QUESTION_LIMIT) {
                    $('.question-number[number=' + currentQuestionNumber + ']').removeClass("current");
                    $('.question-number[number=' + nextQuestionNumber + ']').addClass("current");
                    $('#questions .question-content').removeClass("d-block").addClass("d-none");
                    let content = `#question-content${nextQuestionNumber}`;
                    $(content).removeClass("d-none").addClass("d-block");
                }
                updatePrevNextButton();
            })

            // Previous question
            $(document).on("click", "#btn-previous", function() {
                let currentQuestionNumber = $('.question-number.current').attr("number");
                let previousQuestionNumber = Number(currentQuestionNumber) - 1;
                if (previousQuestionNumber >= 1) {
                    $('.question-number[number=' + currentQuestionNumber + ']').removeClass("current");
                    $('.question-number[number=' + previousQuestionNumber + ']').addClass("current");
                    $('#questions .question-content').removeClass("d-block").addClass("d-none");
                    let content = `#question-content${previousQuestionNumber}`;
                    $(content).removeClass("d-none").addClass("d-block");
                }
                updatePrevNextButton();
            })

            // Submit
            $(document).on("click", "#btn-submit", function() {
                Swal.fire({
                    title: "Are you sure you want to submit the exam?",
                    showCancelButton: true,
                    confirmButtonText: "YES",
                    confirmButtonColor: "#3085d6",
                    cancelButtonText: "NO",
                    cancelButtonColor: "#d33"
                }).then((result) => {
                    if (result.isConfirmed) {
                        finishExam();
                    }
                });
            });

            // Retake
            $(document).on("click", "#btn-retake", function() {
                FINISHED_EXAM = false;
                startExam();
            });
        })
    </script>
</body>
</html>